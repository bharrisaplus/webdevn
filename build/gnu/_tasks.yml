# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'


tasks:
  rear-x64-debug:
    vars:
      BUILD_OUTPUT_DIR: '--outDir:{{.GNU_X64_BUILD_OUTPUT_DIR}}'
    cmds:
      - nim c {{.BUILD_OUTPUT_DIR}} $SOURCE_DIR/webdevn.nim

  rear-x64:
    vars:
      BUILD_OUTPUT_DIR: '--outDir:{{.GNU_X64_BUILD_OUTPUT_DIR}}'
    cmds:
      - nim c {{.BUILD_NIMDEFINEFLAGS}} {{.BUILD_OUTPUT_DIR}} $SOURCE_DIR/webdevn.nim

  wrap-x64:
    vars:
      BUILD_OUTPUT_FILE: '{{.GNU_X64_BUILD_OUTPUT_DIR}}/webdevn'
      BUILD_OUTPUT_FILE_CHKSUM: '{{.BUILD_OUTPUT_FILE}}.sha256'
      BUILD_OUTPUT_ZIP: '{{.GNU_X64_BUILD_OUTPUT_DIR}}/webdevn_gnux64-$VERSION_NUM.zip'
      BUILD_OUTPUT_ZIP_CHKSUM: '{{.BUILD_OUTPUT_ZIP}}.sha256'
    cmds:
      - task: rear-x64
      - shasum -a 256 {{.BUILD_OUTPUT_FILE}} | cut -d ' ' -f 1 > {{.BUILD_OUTPUT_FILE_CHKSUM}}
      - zip -j {{.BUILD_OUTPUT_ZIP}} {{.BUILD_OUTPUT_FILE}} {{.BUILD_OUTPUT_FILE_CHKSUM}}
      - shasum -a 256 {{.BUILD_OUTPUT_ZIP}} | cut -d ' ' -f 1 > {{.BUILD_OUTPUT_ZIP_CHKSUM}}

  sweep-x64:
    cmds:
      - rm -rf {{.GNU_X64_BUILD_OUTPUT_DIR}}/webdevn
      - rm -rf {{.GNU_X64_BUILD_OUTPUT_DIR}}/*.zip
      - rm -rf {{.GNU_X64_BUILD_OUTPUT_DIR}}/*.sha256
