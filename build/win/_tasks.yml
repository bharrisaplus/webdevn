# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'

tasks:
  rear-x64-debug:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/win/x64'
    cmds:
      - nim c --outDir:$BUILD_OUTPUT_DIR $SOURCE_DIR/webdevn.nim

  rear-x64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/win/x64'
    cmds:
      - nim c -d:release --outDir:$BUILD_OUTPUT_DIR $SOURCE_DIR/webdevn.nim

  wrap-x64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/win/x64'
    cmds:
      - task: rear-x64
      - shasum -a 256 $BUILD_OUTPUT_DIR/webdevn.exe | cut -d ' ' -f 1 > $BUILD_OUTPUT_DIR/webdevn.exe.sha256
      - zip -j $BUILD_OUTPUT_DIR/webdevn_winx64-$VERSION_NUM.zip $BUILD_OUTPUT_DIR/webdevn.exe $BUILD_OUTPUT_DIR/webdevn.exe.sha256
      - shasum -a 256 $BUILD_OUTPUT_DIR/webdevn_winx64-$VERSION_NUM.zip | cut -d ' ' -f 1 > $BUILD_OUTPUT_DIR/webdevn_winx64-$VERSION_NUM.zip.sha256

  sweep-x64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/win/x64'
    cmds:
      - rm -rf $BUILD_OUTPUT_DIR/*.exe
      - rm -rf $BUILD_OUTPUT_DIR/*.zip
      - rm -rf $BUILD_OUTPUT_DIR/*.sha256
