# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'

tasks:
  rear-darwinx64-debug:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/mac/darwin'
    cmds:
      - nim c --outDir:$BUILD_OUTPUT_DIR $SOURCE_DIR/webdevn.nim
  rear-darwinx64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/mac/darwin'
    cmds:
      - nim c -d:release --outDir:$BUILD_OUTPUT_DIR $SOURCE_DIR/webdevn.nim

  rear-darwinarm64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/mac/darwin'
    cmds:
      - echo "Hey, it's macos running darwin arm64 here"

  wrap-darwinx64:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/mac/darwin'
    cmds:
      - task: rear-darwinx64
      - shasum -a 256 $BUILD_OUTPUT_DIR/webdevn | cut -d ' ' -f 1 > $BUILD_OUTPUT_DIR/webdevn.sha256
      - zip -j $BUILD_OUTPUT_DIR/webdevn_darwinx64-$VERSION_NUM.zip $BUILD_OUTPUT_DIR/webdevn $BUILD_OUTPUT_DIR/webdevn.sha256
      - shasum -a 256 $BUILD_OUTPUT_DIR/webdevn_darwinx64-$VERSION_NUM.zip | cut -d ' ' -f 1 > $BUILD_OUTPUT_DIR/webdevn_darwinx64-$VERSION_NUM.zip.sha256

  sweep-darwin:
    env:
      BUILD_OUTPUT_DIR: '{{.BUILD_ROOT}}/mac/darwin'
    cmds:
      - rm -rf $BUILD_OUTPUT_DIR/webdevn
      - rm -rf $BUILD_OUTPUT_DIR/*.zip
      - rm -rf $BUILD_OUTPUT_DIR/*.sha256