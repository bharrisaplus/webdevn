# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: '3'

vars:
  MAC_DARWIN_BUILD_OUTPUT_DIR:
    "{{.BUILD_ROOT}}/mac/darwin"


tasks:
  rear-darwinx64-debug:
    vars:
      BUILD_OUTPUT_DIR: '--outDir:{{.MAC_DARWIN_BUILD_OUTPUT_DIR}}'
    cmds:
      - nim c {{.BUILD_OUTPUT_DIR}} $SOURCE_DIR/webdevn.nim

  rear-darwinx64:
    vars:
      BUILD_OUTPUT_DIR: '--outDir:{{.MAC_DARWIN_BUILD_OUTPUT_DIR}}'
    cmds:
      - nim c -d:release {{.BUILD_OUTPUT_DIR}} $SOURCE_DIR/webdevn.nim

  rear-darwinarm64:
    cmds:
      - echo "Hey, it's macos running darwin arm64 here"

  wrap-darwinx64:
    vars:
      BUILD_OUTPUT_FILE: '{{.MAC_DARWIN_BUILD_OUTPUT_DIR}}/webdevn'
      BUILD_OUTPUT_FILE_CHKSUM: '{{.BUILD_OUTPUT_FILE}}.sha256'
      BUILD_OUTPUT_ZIP: '{{.MAC_DARWIN_BUILD_OUTPUT_DIR}}/webdevn_winx64-$VERSION_NUM.zip'
      BUILD_OUTPUT_ZIP_CHKSUM: '{{.BUILD_OUTPUT_ZIP}}.sha256'
    cmds:
      - task: rear-darwinx64
      - shasum -a 256 {{.BUILD_OUTPUT_FILE}} | cut -d ' ' -f 1 > {{.BUILD_OUTPUT_FILE_CHKSUM}}
      - zip -j {{.BUILD_OUTPUT_ZIP}} {{.BUILD_OUTPUT_FILE}} {{.BUILD_OUTPUT_FILE_CHKSUM}}
      - shasum -a 256 {{.BUILD_OUTPUT_ZIP}} | cut -d ' ' -f 1 > {{.BUILD_OUTPUT_ZIP_CHKSUM}}

  sweep-darwin:
    cmds:
      - rm -rf {{.MAC_DARWIN_BUILD_OUTPUT_DIR}}/webdevn
      - rm -rf {{.MAC_DARWIN_BUILD_OUTPUT_DIR}}/*.zip
      - rm -rf {{.MAC_DARWIN_BUILD_OUTPUT_DIR}}/*.sha256